CANDELA v0.3 - How to Run (Quick)

This project includes a single end-to-end script called run_guardian.py.
It checks a document using CANDELA's "Guardian" and prints a clear PASS/FAIL result.

1) Install dependencies

From the CANDELA folder:

  python3 -m pip install -r requirements.txt

Note: This installs torch and sentence-transformers (larger downloads).

Optional (only needed for PDF input):

  python3 -m pip install pdfplumber

If you cannot install pdfplumber, you can use:

  python3 -m pip install pypdf

2) Run the Guardian on a file

Text / Markdown:

  python3 run_guardian.py --input path/to/file.txt --mode strict
  python3 run_guardian.py --input path/to/file.md  --mode regex_only

PDF:

  python3 run_guardian.py --input path/to/file.pdf --mode strict

3) Modes (what they mean)

- strict
  Most thorough. Runs regex checks and waits for the MiniLM semantic check.

- sync_light
  Fastest "full" mode. Runs regex checks immediately and runs the semantic check
  in the background.

- regex_only
  Regex checks only. Fastest, and does not load the ML model.

Offline note

If your computer cannot reach the model download host (for example, no internet, or DNS is blocked),
the script will automatically switch to offline mode to keep the console output clean.

In offline mode, strict/sync_light will only work if the MiniLM model has already been
downloaded (cached) on your machine. If not, either run once with internet access, or use:

  python3 run_guardian.py --input path/to/file.pdf --mode regex_only

4) Compare all modes in one command

  python3 run_guardian.py --input path/to/file.pdf --all-modes

5) Save a machine-readable report (JSON)

  python3 run_guardian.py --input path/to/file.pdf --all-modes --output-json report.json

6) (Optional) Anchor the outputs on-chain (Merkle root)

By default, CANDELA logs checked outputs locally to `./logs/output_log.jsonl`.

If you have Sepolia credentials in a local `.env` file, you can anchor a Merkle root
of the new log entries on Sepolia (so you can later prove a specific output was checked
without putting the whole text on-chain).

  python3 run_guardian.py --input path/to/file.pdf --all-modes --anchor-outputs

6b) (Optional) Pick a demo ruleset pack

Default ruleset (no flag needed):
- baseline: ./src/directives_schema.json

Optional packs (only if you want to explore):
- security_hardening: stricter security patterns
- privacy_strict: stricter privacy heuristics

Examples:

  python3 run_guardian.py --input path/to/file.pdf --mode strict --ruleset security_hardening
  python3 run_guardian.py --input path/to/file.pdf --mode strict --ruleset privacy_strict

7) (Optional demo) Wire CANDELA into a local model (active monitoring)

This demo shows the intended end-state: a model generates text, then CANDELA checks it
immediately and writes an audit log entry.

Step A: install the demo dependency (not required for CANDELA itself)

  python3 -m pip install transformers

Step B: download a small model into the CANDELA folder

Place the model files into:

  ./models/TinyLlama-1.1B-Chat-v1.0/

(This should be a normal model "snapshot" folder: config + tokenizer + weights.)

Step C: run the demo

  python3 demo_model_guardian.py --prompt "Explain what a Merkle root is in one paragraph." --mode strict

Use an optional ruleset pack:

  python3 demo_model_guardian.py --prompt "Hello" --mode strict --ruleset security_hardening

Compare all modes:

  python3 demo_model_guardian.py --prompt "Summarise CANDELA in 5 bullet points." --all-modes

Interactive (actively checks every model output):

  python3 demo_model_guardian.py --prompt "Hello" --interactive --mode strict

Periodic anchoring (optional; avoids anchoring every message):

  python3 demo_model_guardian.py --prompt "Hello" --interactive --mode strict --anchor-outputs --anchor-every 20
  python3 demo_model_guardian.py --prompt "Hello" --interactive --mode strict --anchor-outputs --anchor-interval-min 60

Optional: anchor outputs (requires a local `.env` configured for Sepolia):

  python3 demo_model_guardian.py --prompt "Summarise CANDELA in 5 bullet points." --all-modes --anchor-outputs

Notes

- The Guardian writes local runtime logs under ./logs/.
- The repo is configured to ignore ./logs/ and guardian_report.json so the repo stays clean.
